<!DOCTYPE html>
<nav>
  <a href="tutorial.html">Tutorial</a>
  <a href="index.html">MIDI Note Viewer</a>
  <a href="page2.html">Pattern Checker</a>
  <a href="page3.html">Custom Pattern Checker</a>
  <a href="references.html">References</a>
</nav>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Custom MIDI Sequence</title>
<style>
  body { font-family: Arial; background:#111; color:#eee; padding:40px; }
  h1 { color:#0f0; }
  textarea { width: 100%; height: 80px; background:#222; color:#eee; padding:10px; border-radius:5px; border:none; resize:none; }
  button { padding:10px 20px; margin-top:10px; background:#0f0; color:#000; border:none; border-radius:5px; cursor:pointer; }
  button:hover { background:#0c0; }
  #log { 
    white-space: pre-wrap; 
    background:#222; 
    padding:20px; 
    border-radius:10px; 
    height: 400px;
    overflow-y: auto;
    margin-top:20px;
  }
  nav a { color: #0f0; text-decoration: none; margin-right: 15px; }
  nav a:hover { text-decoration: underline; }
</style>
</head>
<body>

<h1>Custom MIDI Sequence</h1>
<p>Enter your sequence of notes as arrays of MIDI numbers, separated by commas. Example:</p>
<pre>55,60,64,72
67
48,74</pre>

<textarea id="sequenceInput" placeholder="Enter your sequence here..."></textarea>
<br>
<button id="startBtn">Start Sequence Checker</button>

<div id="status">Waiting for sequence...</div>
<div id="log"></div>

<script>
const logBox = document.getElementById("log");
const statusBox = document.getElementById("status");
const startBtn = document.getElementById("startBtn");

let SEQUENCE = [];
let sequenceIndex = 0;
let currentStepPressed = new Set();
const CHECKPOINT_SIZE = 4;
let lastCheckpoint = 0;

function log(msg) {
  logBox.textContent += msg + "\n";
  logBox.scrollTop = logBox.scrollHeight;
}

// Parse the user's input into arrays of numbers
function parseSequence(input) {
  const lines = input.split("\n");
  const sequence = lines.map(line => line.split(",").map(n => parseInt(n.trim())).filter(n => !isNaN(n)));
  return sequence.filter(arr => arr.length > 0);
}

async function initMIDI() {
  try {
    const access = await navigator.requestMIDIAccess();
    statusBox.textContent = "MIDI ready! Connect your keyboard.";

    for (let input of access.inputs.values()) {
      log("Connected to: " + input.name);

      input.onmidimessage = (msg) => {
        const [command, note, velocity] = msg.data;
        const NOTE_ON = (command === 0x90 && velocity > 0);
        if (!NOTE_ON) return;

        if (!SEQUENCE[sequenceIndex]) return;

        const expected = SEQUENCE[sequenceIndex];

        if (!expected.includes(note)) {
          log("Wrong note! Restarting.");
          sequenceIndex = 0;
          currentStepPressed.clear();
          lastCheckpoint = 0;
          return;
        }

        currentStepPressed.add(note);

        if (expected.every(n => currentStepPressed.has(n))) {
          sequenceIndex++;
          currentStepPressed.clear();

          const checkpointNumber = Math.floor(sequenceIndex / CHECKPOINT_SIZE);
          if (checkpointNumber > lastCheckpoint) {
            log(`Checkpoint ${checkpointNumber} reached.`);
            lastCheckpoint = checkpointNumber;
          }

          if (sequenceIndex >= SEQUENCE.length) {
            log("FULL PATTERN COMPLETED!");
            sequenceIndex = 0; // optional: reset
          }
        }
      };
    }

  } catch (err) {
    statusBox.textContent = "Failed to access MIDI.";
    log(err);
  }
}

startBtn.addEventListener("click", () => {
  const input = document.getElementById("sequenceInput").value;
  SEQUENCE = parseSequence(input);
  if (SEQUENCE.length === 0) {
    alert("Please enter a valid sequence.");
    return;
  }
  logBox.textContent = "";
  sequenceIndex = 0;
  currentStepPressed.clear();
  lastCheckpoint = 0;
  statusBox.textContent = "Sequence loaded! Connect your keyboard.";
});

initMIDI();
</script>

</body>
</html>










